{
  "project": "FieldOps",
  "branchName": "ralph/field-management-app",
  "description": "Field Management PWA - Offline-first task management for field service crews with photo uploads, GPS tracking, and admin configuration",
  "userStories": [
    {
      "id": "US-001",
      "title": "Database schema setup",
      "description": "As a developer, I need the Supabase database schema created so all features have data storage.",
      "acceptanceCriteria": [
        "Create users table with: id, email, role (admin/field_user), created_at, updated_at",
        "Create divisions table with: id, name, color, icon, created_at",
        "Create statuses table with: id, name, color, order, is_complete, is_default, created_at",
        "Create tasks table with: id, title, description, status_id, division_id, location_lat, location_lng, address, due_date, assigned_user_id, custom_fields (JSONB), created_at, updated_at, deleted_at",
        "Create comments table with: id, task_id, user_id, content, created_at",
        "Create photos table with: id, task_id, user_id, storage_path, timestamp, gps_lat, gps_lng, created_at",
        "Create files table with: id, task_id, user_id, storage_path, file_name, file_size, created_at",
        "Create custom_field_definitions table with: id, name, field_type, options (JSONB), required, order, created_at",
        "Create task_templates table with: id, name, default_title, default_description, default_division_id, default_custom_fields (JSONB), created_at",
        "Create branding table with: id, logo_url, primary_color, accent_color, app_name, created_at",
        "All foreign key relationships properly defined",
        "npm run typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Completed: Created SQL migration with all 10 tables and TypeScript types"
    },
    {
      "id": "US-002",
      "title": "Supabase RLS policies",
      "description": "As a developer, I need Row Level Security policies so users can only access appropriate data.",
      "acceptanceCriteria": [
        "Admins can read/write all tables",
        "Field users can read all tasks, divisions, statuses, custom_field_definitions, templates, branding",
        "Field users can create/update task status, comments, photos, files",
        "Field users can only read their own user profile",
        "Users can only read data from their own organization (if multi-tenant)",
        "RLS enabled on all tables",
        "npm run typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Completed: Created RLS policies for all tables with is_admin() helper function. Admins have full access, field users can read shared data and create their own content."
    },
    {
      "id": "US-003",
      "title": "User authentication with Supabase Auth",
      "description": "As a user, I want to log in securely so that I can access my company's tasks.",
      "acceptanceCriteria": [
        "Login page with email/password form",
        "Supabase Auth integration for authentication",
        "Remember me checkbox keeps user logged in for 30 days",
        "Session token stored securely for offline access",
        "Role-based redirect: Admin → /admin/dashboard, Field User → /tasks",
        "Logout functionality clears session",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Completed: Login page at /login, Supabase Auth integration, remember me checkbox, role-based redirects (admin→/admin/dashboard, field_user→/tasks), logout button clears session. Middleware protects routes and handles auth."
    },
    {
      "id": "US-004",
      "title": "PWA manifest and service worker setup",
      "description": "As a user, I want to install the app on my device so it feels native.",
      "acceptanceCriteria": [
        "Web App Manifest with name, icons (192px, 512px), theme_color, background_color",
        "display: standalone in manifest",
        "Service worker registered on app load",
        "App shell (HTML, CSS, JS) cached for offline access",
        "Works on iOS Safari, Android Chrome, Desktop Chrome/Edge",
        "npm run typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Completed: PWA manifest with name/icons/theme colors, service worker for app shell caching, registration on app load via client component, Apple Web App meta tags for iOS Safari."
    },
    {
      "id": "US-005",
      "title": "Admin - Create divisions/flags",
      "description": "As an admin, I want to create divisions or flags so tasks can be categorized.",
      "acceptanceCriteria": [
        "Admin page at /admin/divisions",
        "Form to create division with: name (required), color (color picker), icon (optional dropdown)",
        "List of existing divisions with edit and delete buttons",
        "Edit modal pre-fills current values",
        "Delete shows confirmation dialog",
        "Changes saved to Supabase",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Completed: Admin page at /admin/divisions with form to create divisions (name, color picker, icon dropdown), list of existing divisions with edit/delete buttons, inline edit form with pre-filled values, delete confirmation dialog modal. Server actions in lib/divisions/actions.ts handle CRUD operations with Supabase."
    },
    {
      "id": "US-006",
      "title": "Admin - Create custom statuses",
      "description": "As an admin, I want to define custom task statuses so workflows match my business.",
      "acceptanceCriteria": [
        "Admin page at /admin/statuses",
        "Form to create status with: name (required), color (color picker), order (number)",
        "Checkbox to mark status as 'complete' (affects reporting)",
        "Checkbox to mark as default status for new tasks",
        "List of statuses sortable via drag-and-drop to reorder",
        "Edit and delete functionality",
        "Changes saved to Supabase",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Completed: Admin page at /admin/statuses with form to create statuses (name, color picker, order, is_complete checkbox, is_default checkbox). List of existing statuses with drag-and-drop reordering via HTML5 drag events. Edit/delete buttons with inline edit form and delete confirmation modal. Server actions in lib/statuses/actions.ts handle CRUD operations with Supabase. Only one status can be marked as default at a time."
    },
    {
      "id": "US-007",
      "title": "Admin - Task management table view",
      "description": "As an admin, I want to view all tasks in a table so I can manage work.",
      "acceptanceCriteria": [
        "Admin page at /admin/tasks",
        "Table showing: title, status, division, assigned user, due date, created date",
        "Columns are sortable (click header)",
        "Filter dropdowns for: status, division, assigned user",
        "Search input filters by title or description",
        "Pagination with 25 items per page",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Completed: Admin page at /admin/tasks with sortable table (title, status, division, assigned user, due date, created date), filter dropdowns for status/division/assigned user, search input for title/description, pagination with 25 items per page. Server actions in lib/tasks/actions.ts for data fetching with joins to related tables."
    },
    {
      "id": "US-008",
      "title": "Admin - Create and edit tasks",
      "description": "As an admin, I want to create and edit tasks so field users have work assigned.",
      "acceptanceCriteria": [
        "Create task button opens modal form",
        "Form fields: title, description (textarea), status (dropdown), division (dropdown), due date (date picker), assigned user (dropdown)",
        "Location fields: address (text), latitude/longitude (number inputs)",
        "Save creates task in Supabase",
        "Edit button on table row opens same modal with pre-filled values",
        "Delete button shows confirmation, performs soft delete (sets deleted_at)",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 8,
      "passes": true,
      "notes": "Completed: Create Task button opens modal form with all fields (title, description, status dropdown, division dropdown, due date picker, assigned user dropdown, address, lat/lng). Edit button on each row opens same modal pre-filled. Delete button in modal shows inline confirmation and performs soft delete (sets deleted_at). Server actions in lib/tasks/actions.ts for createTask, updateTask, deleteTask. getDefaultStatus() used to pre-select default status for new tasks."
    },
    {
      "id": "US-009",
      "title": "View task list (field user)",
      "description": "As a field user, I want to see all tasks so I can plan my work.",
      "acceptanceCriteria": [
        "Task list page at /tasks",
        "Card-based layout (not table)",
        "Each card shows: title, status badge (colored), division badge, location, due date, assigned user avatar/name",
        "Cards are minimum 72px height with high-contrast text",
        "Filter buttons for status (All, To Do, In Progress, Complete)",
        "Filter dropdown for division",
        "Tasks fetched from Supabase on load",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 9,
      "passes": true,
      "notes": "Completed: Task list page at /tasks with card-based layout. Each card shows title, status badge (colored), division badge, location, due date, assigned user avatar/name. Cards are minimum 72px height with high-contrast text. Filter buttons for status (All, To Do, In Progress, Complete) and dropdown for division. Tasks fetched from Supabase on load."
    },
    {
      "id": "US-010",
      "title": "View task detail (field user)",
      "description": "As a field user, I want to view task details so I know what work is required.",
      "acceptanceCriteria": [
        "Task detail page at /tasks/[id]",
        "Shows: title, description, status, division, due date, assigned user, location/address",
        "Map preview showing job location (static image from map tile service)",
        "Get Directions button opens native maps app (Google Maps/Apple Maps link)",
        "Large 'Update Status' button always visible at bottom",
        "Custom fields section displays any JSONB custom field values",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 10,
      "passes": true,
      "notes": "Completed: Task detail page at /tasks/[id] showing title, description, status badge, division badge, due date, assigned user, location/address with map preview (OpenStreetMap embed), Get Directions button (Google Maps link), Update Status button fixed at bottom, and custom fields section. Server component with client TaskDetail component."
    },
    {
      "id": "US-011",
      "title": "Update task status (field user)",
      "description": "As a field user, I want to update a task's status so the office knows my progress.",
      "acceptanceCriteria": [
        "Status update UI shows large buttons for each status (fetched from statuses table)",
        "Buttons are minimum 64px tall, single-tap selection",
        "Current status is visually highlighted",
        "Selecting new status updates task in Supabase",
        "Optimistic UI: status updates immediately before server confirms",
        "Success toast notification after save",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 11,
      "passes": true,
      "notes": "Completed: Status update page at /tasks/[id]/status with large touch-friendly buttons (min 64px tall), visual highlighting of current status with ring and scale effect, optimistic UI updates, success/error toast notifications with slide-up animation. Server action updateTaskStatus in lib/tasks/actions.ts. Auto-redirect back to task detail after successful update."
    },
    {
      "id": "US-012",
      "title": "Photo upload - camera and gallery",
      "description": "As a field user, I want to capture and upload photos for task documentation.",
      "acceptanceCriteria": [
        "Photo upload section on task detail page",
        "Large 'Take Photo' button (min 64px tall) opens device camera",
        "Gallery picker button for selecting existing photos",
        "Support multiple photos per upload (batch select)",
        "Photos displayed as thumbnails after selection",
        "Upload button sends photos to Supabase Storage",
        "Upload progress indicator shown during upload",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 12,
      "passes": true,
      "notes": "Completed: Photo upload section on task detail page with Take Photo button (64px tall, opens camera with capture='environment'), Gallery button for batch selecting existing photos. Selected photos display as thumbnails in 3-column grid with remove button. Upload button sends photos to Supabase Storage with circular progress indicator. Server actions in lib/photos/actions.ts for CRUD operations."
    },
    {
      "id": "US-013",
      "title": "Photo processing - compression and watermark",
      "description": "As a field user, I want photos compressed and watermarked automatically.",
      "acceptanceCriteria": [
        "Photos resized client-side to max 1920px on longest edge",
        "JPEG quality set to 80%",
        "Watermark added to bottom corner: timestamp in format 'YYYY-MM-DD HH:mm'",
        "Watermark includes GPS coordinates if available: 'lat, lng'",
        "Watermark is semi-transparent white text with dark shadow for readability",
        "Processing happens before upload",
        "npm run typecheck passes"
      ],
      "priority": 13,
      "passes": true,
      "notes": "Completed: Client-side photo processing with Canvas API. Resizes to max 1920px on longest edge, JPEG quality 80%, watermark with timestamp (YYYY-MM-DD HH:mm) and GPS coordinates in bottom right corner. Semi-transparent white text with dark shadow for readability. Processing happens before upload. Uses Geolocation API to capture GPS."
    },
    {
      "id": "US-014",
      "title": "Photo metadata and GPS capture",
      "description": "As a field user, I want photos tagged with location and timestamp metadata.",
      "acceptanceCriteria": [
        "Request Geolocation API permission when uploading photos",
        "If permission granted, capture current GPS coordinates",
        "Store in photos table: gps_lat, gps_lng, timestamp, uploader user_id",
        "If GPS unavailable, proceed without coordinates (not required)",
        "Photo record linked to task_id",
        "npm run typecheck passes"
      ],
      "priority": 14,
      "passes": true,
      "notes": "Verified: GPS coordinates requested via Geolocation API when photos selected (lib/photos/process-photo.ts:236). Coordinates captured and stored in photos table via createPhotoRecord (lib/photos/actions.ts:66-67). Timestamp and user_id also stored. If GPS unavailable, proceeds gracefully with null coordinates. Photo records linked to task_id."
    },
    {
      "id": "US-015",
      "title": "View task photos",
      "description": "As a field user, I want to view photos attached to a task.",
      "acceptanceCriteria": [
        "Photos section on task detail page shows thumbnails grid",
        "Clicking thumbnail opens full-size image in lightbox/modal",
        "Lightbox shows metadata: timestamp, GPS coordinates, uploader name",
        "Navigation arrows to browse multiple photos",
        "Close button to dismiss lightbox",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 15,
      "passes": true,
      "notes": "Completed: PhotoGallery component with thumbnail grid (3-5 columns responsive), full-size lightbox modal with metadata display (timestamp, GPS coordinates with map link, uploader name/avatar), navigation arrows and keyboard navigation (left/right arrows, Escape to close), close button."
    },
    {
      "id": "US-016",
      "title": "File upload",
      "description": "As a field user, I want to attach files to tasks for documentation.",
      "acceptanceCriteria": [
        "File upload section on task detail page",
        "File picker button supporting: PDF, DOC, DOCX, XLS, XLSX, images",
        "Max file size validation: 25MB per file, show error if exceeded",
        "Upload progress indicator during upload",
        "Files stored in Supabase Storage",
        "File record created with: file_name, file_size, storage_path, task_id, user_id",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 16,
      "passes": true,
      "notes": "Completed: FileUpload component with file picker (PDF, DOC/DOCX, XLS/XLSX, images), 25MB size validation with error display, circular progress indicator during upload, files stored in Supabase Storage 'files' bucket, file records created via createFileRecord server action in lib/files/actions.ts."
    },
    {
      "id": "US-017",
      "title": "View and download task files",
      "description": "As a field user, I want to view files attached to a task and download them.",
      "acceptanceCriteria": [
        "Files section on task detail page lists all attached files",
        "Each file shows: file name, file size formatted (KB/MB), upload date",
        "Click on file opens in new tab (for viewable types) or downloads",
        "Download button explicitly downloads file",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 17,
      "passes": true,
      "notes": "Completed: FileList component with file name, formatted size (KB/MB), relative upload date, and uploader email. Clicking file opens in new tab for viewable types (PDF, images) or downloads. Explicit download button on each file. Files fetched server-side and passed to TaskDetail component."
    },
    {
      "id": "US-018",
      "title": "Add comments to task",
      "description": "As a field user, I want to add comments to tasks to communicate with the office.",
      "acceptanceCriteria": [
        "Comment input section on task detail page",
        "Large text input field (min height 64px) keyboard-friendly",
        "Submit button posts comment to Supabase",
        "Comment record includes: content, user_id, task_id, created_at",
        "New comment appears in list immediately after submit",
        "Toast notification confirms comment added",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 18,
      "passes": true,
      "notes": "Completed: CommentInput component with large 64px textarea, server actions in lib/comments/actions.ts for CRUD, toast notifications for success/error, new comments appear immediately in list (newest-first), relative timestamps. Comments section integrated into task detail page."
    },
    {
      "id": "US-019",
      "title": "View comments on task",
      "description": "As a field user, I want to read comments on a task for context.",
      "acceptanceCriteria": [
        "Comments section on task detail page shows all comments",
        "Comments sorted newest-first",
        "Each comment shows: author name/avatar, content, relative timestamp ('2 hours ago')",
        "Clear visual distinction between different users (avatar or color)",
        "Empty state message when no comments exist",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 19,
      "passes": true,
      "notes": "Completed: CommentList component with distinct user avatar colors (8 color palette based on user ID hash), empty state message with chat bubble icon when no comments, comments sorted newest-first with relative timestamps, larger 40px avatars for better visibility."
    },
    {
      "id": "US-020",
      "title": "Voice-to-text for comments",
      "description": "As a field user, I want to dictate comments to avoid typing with gloves.",
      "acceptanceCriteria": [
        "Microphone button next to comment input",
        "Click starts browser Speech Recognition API",
        "Visual indicator shows recording is active",
        "Transcribed text appears in comment input field",
        "User can edit before submitting",
        "Graceful fallback if speech API unavailable (hide button)",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 20,
      "passes": true,
      "notes": "Completed: Microphone button in comment input using Web Speech Recognition API. Visual indicator with red pulsing dot when recording, textarea border turns red. Transcribed text appends to existing content. Button hidden gracefully if speech API unavailable. User can edit text before submitting."
    },
    {
      "id": "US-021",
      "title": "Offline - IndexedDB setup with Dexie",
      "description": "As a developer, I need IndexedDB storage for offline data caching.",
      "acceptanceCriteria": [
        "Dexie.js installed and configured",
        "Database schema mirrors Supabase tables: tasks, divisions, statuses, comments, photos, files, custom_field_definitions",
        "Sync timestamp tracked per table",
        "Helper functions: saveToLocal, getFromLocal, clearLocal",
        "npm run typecheck passes"
      ],
      "priority": 21,
      "passes": true,
      "notes": "Completed: Dexie.js installed and configured with database schema mirroring Supabase tables (tasks, divisions, statuses, comments, photos, files, custom_field_definitions). Sync timestamp tracked per table via sync_meta table. Helper functions: saveToLocal, getFromLocal, clearLocal, plus bulk operations and task-specific helpers."
    },
    {
      "id": "US-022",
      "title": "Offline - Cache task data for offline viewing",
      "description": "As a field user, I want task data cached so I can view tasks offline.",
      "acceptanceCriteria": [
        "On initial load, all tasks synced to IndexedDB",
        "On subsequent loads, check IndexedDB first, then fetch updates from server",
        "Task list page reads from IndexedDB when offline",
        "Task detail page reads from IndexedDB when offline",
        "Visual indicator (banner or icon) when app is offline",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 22,
      "passes": true,
      "notes": "Completed: useOfflineSync hook syncs tasks/statuses/divisions to IndexedDB on load. useTaskOffline hook syncs individual task with related photos/files/comments. useOnlineStatus hook tracks online/offline status. OfflineIndicator component shows banner when offline or using cached data. TaskListOfflineWrapper and TaskDetailOfflineWrapper handle offline-first data loading."
    },
    {
      "id": "US-023",
      "title": "Offline - Queue mutations for later sync",
      "description": "As a field user, I want my changes saved locally when offline.",
      "acceptanceCriteria": [
        "Pending mutations table in IndexedDB: id, type (status/comment/photo/file), payload, created_at, status (pending/syncing/failed)",
        "Status updates queued when offline",
        "Comments queued when offline",
        "Photos queued in IndexedDB when offline (blob stored locally)",
        "Files queued when offline",
        "Queue count displayed in UI ('3 pending changes')",
        "npm run typecheck passes"
      ],
      "priority": 23,
      "passes": true,
      "notes": "Completed: Added pending_mutations table to Dexie schema (v2) with typed mutation payloads. Created mutation-queue.ts with queueStatusMutation, queueCommentMutation, queuePhotoMutation, queueFileMutation helpers. Updated status-update-ui.tsx, comment-input.tsx, photo-upload.tsx, file-upload.tsx to queue mutations when offline. Photos/files store blobs locally in IndexedDB. Updated offline-indicator.tsx to show pending changes count. Created pending-changes-indicator.tsx for standalone queue display."
    },
    {
      "id": "US-024",
      "title": "Offline - Background sync when online",
      "description": "As a field user, I want pending changes to sync automatically when I'm back online.",
      "acceptanceCriteria": [
        "Background Sync API registered for pending mutations",
        "When online, process queue in order (FIFO)",
        "Each mutation sent to Supabase",
        "On success, remove from queue and update local cache",
        "On failure, keep in queue and mark as failed",
        "Sync status indicator: 'Synced', 'Syncing...', 'X pending'",
        "npm run typecheck passes"
      ],
      "priority": 24,
      "passes": true,
      "notes": "Completed: Created sync-processor.ts with processAllMutations() for FIFO queue processing. Each mutation type (status/comment/photo/file) sent to Supabase with proper error handling. On success, mutation removed from queue and local cache updated. On failure, marked as failed with error message. Updated service worker (sw.js) with Background Sync API support - listens for 'sync' events and notifies clients. Created useBackgroundSync hook for auto-sync when online and listening for SW messages. Created SyncStatusIndicator component with three variants (default, header, badge) showing Synced/Syncing.../X pending/X failed states."
    },
    {
      "id": "US-025",
      "title": "Offline - Manual sync and pull-to-refresh",
      "description": "As a field user, I want to manually trigger sync and refresh data.",
      "acceptanceCriteria": [
        "Manual 'Sync Now' button in header or profile",
        "Pull-to-refresh gesture on task list syncs with server",
        "Refresh fetches latest tasks, statuses, divisions from server",
        "Updates local IndexedDB cache",
        "Shows loading indicator during sync",
        "Toast notification on sync complete or error",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 25,
      "passes": true,
      "notes": "Completed: SyncNowButton component (icon/header/default variants), PullToRefresh wrapper with touch gestures, SyncToast component with auto-dismiss. TaskListOfflineWrapper integrates all components with Sync Now button row, pull-to-refresh gesture, last synced timestamp display, loading indicators, and toast notifications on success/error. Uses router.refresh() to fetch fresh data from server and syncs to IndexedDB."
    },
    {
      "id": "US-026",
      "title": "Offline - Conflict detection",
      "description": "As a field user, I want conflicts flagged so I can resolve them.",
      "acceptanceCriteria": [
        "Compare updated_at timestamps on sync",
        "If server record updated after local change queued, flag as conflict",
        "Non-conflicting fields auto-merge silently",
        "Conflicting fields show UI: 'Your change' vs 'Server change'",
        "User can choose which version to keep",
        "After resolution, mark mutation as resolved",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 26,
      "passes": true,
      "notes": "Completed: Conflict detection in sync-processor.ts compares updated_at timestamps and previous_status_id to detect conflicts. ConflictInfo type stores local_value, server_value, and timestamps. ConflictResolution component shows 'Your Change' vs 'Server Version' with blue/green cards. User clicks 'Keep My Change' (force_overwrite) or 'Use Server Version' (discard mutation). SyncStatusIndicator shows conflict count and Resolve button. ConflictModal provides popup for conflict resolution."
    },
    {
      "id": "US-027",
      "title": "Admin - Custom fields configuration",
      "description": "As an admin, I want to add custom fields to tasks for industry-specific data.",
      "acceptanceCriteria": [
        "Admin page at /admin/custom-fields",
        "Form to create field: name, type (text/number/date/dropdown/checkbox), required toggle",
        "Dropdown type shows additional input for comma-separated options",
        "List of fields with drag-and-drop reordering",
        "Edit and delete functionality",
        "Changes saved to custom_field_definitions table",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 27,
      "passes": true,
      "notes": "Completed: Admin page at /admin/custom-fields with form to create custom fields (name, type dropdown with text/number/date/dropdown/checkbox options, required toggle). Dropdown type shows comma-separated options input. List of fields with drag-and-drop reordering via HTML5 drag events. Edit/delete functionality with inline edit form and delete confirmation modal. Server actions in lib/custom-fields/actions.ts for CRUD operations with Supabase."
    },
    {
      "id": "US-028",
      "title": "Custom fields on task forms",
      "description": "As an admin, I want custom fields to appear on task create/edit forms.",
      "acceptanceCriteria": [
        "Task create/edit form fetches custom_field_definitions",
        "Renders appropriate input for each type: text input, number input, date picker, dropdown, checkbox",
        "Required fields show validation error if empty",
        "Values saved to tasks.custom_fields JSONB column",
        "Values displayed on task detail view",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 28,
      "passes": true,
      "notes": "Completed: Task create/edit form fetches custom_field_definitions and renders appropriate inputs (text, number, date, dropdown, checkbox). Required fields show validation errors. Values saved to tasks.custom_fields JSONB column. Task detail view displays custom field values with proper labels from definitions. Typecheck passes."
    },
    {
      "id": "US-029",
      "title": "Admin - User management",
      "description": "As an admin, I want to manage users so I can control access.",
      "acceptanceCriteria": [
        "Admin page at /admin/users",
        "Table showing: email, role, last active date, status (active/deactivated)",
        "Invite user button: form with email and role dropdown (Admin/Field User)",
        "Invite sends email via Supabase Auth",
        "Edit user role via dropdown",
        "Deactivate button revokes access but preserves history",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 29,
      "passes": true,
      "notes": "Completed: Admin page at /admin/users with table showing email, role, last active date, status. Invite user modal with email and role dropdown (Admin/Field User). Sends invite via Supabase Auth admin.inviteUserByEmail(). Inline edit for user role via dropdown. Deactivate button with confirmation revokes access but preserves history (is_active flag). Reactivate button for deactivated users. Added is_active and last_active_at fields to users table via migration 003."
    },
    {
      "id": "US-030",
      "title": "Admin - Branding and white-label",
      "description": "As an admin, I want to customize branding so the app reflects my company.",
      "acceptanceCriteria": [
        "Admin page at /admin/branding",
        "Logo upload: accepts image, stores in Supabase Storage, displays in header",
        "Primary color picker: applies to buttons, headers",
        "Accent color picker: applies to status badges, highlights",
        "App name input: shown in PWA install and header",
        "Preview section shows how colors/logo will look",
        "Changes saved to branding table",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 30,
      "passes": true,
      "notes": "Completed: Admin page at /admin/branding with logo upload (Supabase Storage 'branding' bucket), primary/accent color pickers with hex input, app name input, live preview section showing header/buttons/badges/links/task card previews with selected colors and logo. Changes saved to branding table via saveBranding server action. Typecheck passes."
    },
    {
      "id": "US-031",
      "title": "Apply branding throughout app",
      "description": "As a user, I want to see company branding applied to the app.",
      "acceptanceCriteria": [
        "Fetch branding settings on app load",
        "Logo displayed in header/navigation",
        "Primary color applied to buttons, header background",
        "Accent color applied to status badges, links, highlights",
        "App name shown in header and PWA title",
        "Branding cached for offline use",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 31,
      "passes": true,
      "notes": "Completed: BrandingProvider context fetches branding on app load and caches in localStorage. AppHeader component displays logo/initial and app name from branding. Primary color applied to Get Directions button, assigned user avatars. Accent color applied to Update Status button. Dynamic manifest at /manifest.json uses branding app name and theme color. Theme color meta tag updated dynamically. All pages updated to use branded headers. Typecheck passes."
    },
    {
      "id": "US-032",
      "title": "Admin - Task templates",
      "description": "As an admin, I want to create task templates for common job types.",
      "acceptanceCriteria": [
        "Admin page at /admin/templates",
        "Form to create template: name, default title, default description, default division, default custom field values",
        "List of templates with edit and delete",
        "Templates saved to task_templates table",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 32,
      "passes": true,
      "notes": "Completed: Admin page at /admin/templates with form to create templates (name, default title, default description, default division dropdown, default custom field values). List of existing templates with edit/delete buttons, delete confirmation modal. Server actions in lib/templates/actions.ts for CRUD operations. TemplateForm supports all custom field types (text, number, date, dropdown, checkbox). Typecheck passes."
    },
    {
      "id": "US-033",
      "title": "Create task from template",
      "description": "As an admin, I want to create tasks from templates quickly.",
      "acceptanceCriteria": [
        "Task create form has 'Create from Template' dropdown",
        "Selecting template pre-fills: title, description, division, custom fields",
        "User can override any pre-filled values",
        "Still need to set: status, due date, assigned user, location",
        "Save creates task with template defaults merged with overrides",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 33,
      "passes": true,
      "notes": "Completed: Added 'Create from Template' dropdown to task create form. Selecting a template pre-fills title, description, division, and custom fields. User can override any pre-filled values. Status, due date, assigned user, and location fields must still be set manually. Template defaults merge with overrides on save. Typecheck passes."
    },
    {
      "id": "US-034",
      "title": "Admin - Media gallery",
      "description": "As an admin, I want to view all uploaded photos and files.",
      "acceptanceCriteria": [
        "Admin page at /admin/media",
        "Gallery grid view of all photos across tasks",
        "Filter dropdowns: by task, by user, by division, by date range",
        "Click photo opens full-size with metadata (timestamp, GPS, uploader, task link)",
        "Download individual photos",
        "Bulk selection checkbox on each photo",
        "Download selected button creates zip",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 34,
      "passes": true,
      "notes": "Completed: Admin page at /admin/media with gallery grid view of all photos. Filter dropdowns for task, user, division, and date range. Full-size lightbox with metadata (timestamp, GPS with map link, uploader info, task link with division badge). Individual photo download in lightbox. Bulk selection checkboxes on each photo with Select All option. Download Selected creates zip using JSZip library. Typecheck passes."
    },
    {
      "id": "US-035",
      "title": "Admin - Bulk task actions",
      "description": "As an admin, I want to perform bulk actions on multiple tasks.",
      "acceptanceCriteria": [
        "Checkbox on each task row in admin table",
        "Select all checkbox in header",
        "Shift+Click selects range of tasks",
        "Bulk action dropdown appears when tasks selected",
        "Bulk actions: Assign to user, Change status, Delete",
        "Confirmation dialog before destructive actions",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 35,
      "passes": true,
      "notes": "Completed: Checkbox on each task row with visual highlight for selected rows. Select all checkbox in header with indeterminate state support. Shift+click range selection. Bulk action bar appears when tasks selected with actions: Assign to User (with unassign option), Change Status, Delete. Delete action shows confirmation dialog. Server actions bulkAssignTasks, bulkChangeStatus, bulkDeleteTasks in lib/tasks/actions.ts. Typecheck passes."
    },
    {
      "id": "US-036",
      "title": "Admin - Export data to CSV",
      "description": "As an admin, I want to export task data for reporting.",
      "acceptanceCriteria": [
        "Export to CSV button on admin tasks page",
        "Exports visible/filtered tasks (respects current filters)",
        "CSV includes: ID, title, status, division, assigned user, due date, created date, location",
        "Downloads file with timestamp in filename",
        "npm run typecheck passes"
      ],
      "priority": 36,
      "passes": true,
      "notes": "Completed: Export to CSV button added to admin tasks page header. Exports visible/filtered tasks with proper CSV escaping for commas, quotes, and newlines. CSV includes all required columns. Filename includes ISO timestamp (tasks-export-YYYY-MM-DDTHH-MM-SS.csv). Typecheck passes."
    },
    {
      "id": "US-037",
      "title": "Responsive layout - Mobile first",
      "description": "As a field user on mobile, I want large touch targets usable with gloves.",
      "acceptanceCriteria": [
        "All tap targets minimum 48x48px, primary actions 64px",
        "No hover-dependent interactions",
        "Bottom navigation bar with max 4 items: Tasks, Upload, Sync, Profile",
        "Font size minimum 16px for body text",
        "High contrast mode support (prefers-contrast media query)",
        "Works in landscape and portrait orientations",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 37,
      "passes": true,
      "notes": "Completed: Mobile bottom navigation with 4 items (Tasks, Upload, Sync, Profile). All tap targets updated to minimum 48x48px using touch-target CSS class, primary actions 64px with touch-target-primary. Hover interactions replaced with active states. Body font minimum 16px. High contrast mode via @media (prefers-contrast: more). Safe area insets for notched devices. Landscape orientation support. Created profile page for field users. Typecheck passes."
    },
    {
      "id": "US-038",
      "title": "Admin dashboard - Desktop layout",
      "description": "As an admin on desktop, I want denser information display.",
      "acceptanceCriteria": [
        "Side navigation with expanded labels (collapsible)",
        "Navigation sections: Dashboard, Tasks, Media, Configuration (sub-items)",
        "Dashboard shows summary stats: tasks by status counts, recent uploads",
        "Keyboard shortcuts: n=new task, /=search, ?=help",
        "Multi-column layout adapts to screen width",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 38,
      "passes": true,
      "notes": "Completed: AdminSidebar with collapsible state and expandable sections (Dashboard, Tasks, Media, Configuration with sub-items). AdminLayout wrapper with multi-column responsive design. DashboardContent shows tasks by status counts with progress bars, total/completed/pending/overdue task counts, recent uploads gallery, user stats. Keyboard shortcuts: n=new task, /=search, ?=help modal. Mobile sidebar overlay with hamburger menu. Typecheck passes."
    },
    {
      "id": "US-039",
      "title": "PWA install prompt and splash screen",
      "description": "As a user, I want to be prompted to install the app.",
      "acceptanceCriteria": [
        "beforeinstallprompt event captured",
        "Install banner shown after 2nd visit or after meaningful action",
        "Install button triggers native install prompt",
        "Splash screen shows company logo (from branding) on app launch",
        "Splash screen matches theme colors from branding",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 39,
      "passes": true,
      "notes": "Completed: PWA install prompt captures beforeinstallprompt event, shows install banner after 2nd visit or meaningful action (like status update). Install button triggers native browser install prompt. PWASplashScreen shows company logo/initial with branding colors when app launches in standalone mode. Manifest updated with branding-based background_color for native splash. Typecheck passes."
    },
    {
      "id": "US-040",
      "title": "Dark mode support",
      "description": "As a field user, I want dark mode for outdoor readability.",
      "acceptanceCriteria": [
        "Detect prefers-color-scheme media query",
        "Dark mode styles for all screens",
        "Toggle in profile/settings to override system preference",
        "Preference persisted in localStorage",
        "Colors maintain sufficient contrast in both modes",
        "npm run typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 40,
      "passes": true,
      "notes": "Completed: ThemeProvider context detects prefers-color-scheme media query and supports system/light/dark modes. ThemeToggle component in profile/settings page allows override. Preference persisted in localStorage (fieldops_theme_preference key). Class-based dark mode via Tailwind v4 @custom-variant directive. Existing components already had dark: class prefixes for sufficient contrast. Typecheck passes."
    }
  ]
}
